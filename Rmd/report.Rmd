---
title: "Report"
output:
  html_document:
    df_print: paged
    toc: true
    toc_depth: 5
    toc_float: true
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = TRUE,
	warning = TRUE, 
	cache.extra = knitr::rand_seed,
	out.width = "100%",
	results = "asis",
	dev.args = list(png = list(type = "cairo"))
)
options(knitr.kable.NA = '-',
		ggplot2.discrete.fill = ggsci::pal_tron("legacy")(7),
		ggplot2.discrete.colour = ggsci::pal_tron("legacy")(7)
)

```

```{r prepare, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

# load packages
library(papaja)
library(knitr)
library(tidyverse)
library(lubridate)
library(scales)
library(DiagrammeR)
library(janitor)
library(lme4)
library(broom.mixed)
library(gt)
library(patchwork)
library(htmltools)
library(wesanderson)
library(shiny)
library(here)

# create functions
logit_to_prob <- function(x) exp(x) / (1 + exp(x))

theme_custom <- function(){
	theme(
		panel.background = element_rect(fill = "transparent"),
		panel.grid = element_blank(),
		#panel.grid = element_line(colour = "grey", linetype = "dotted"),
		panel.border = element_rect(fill = "transparent", colour = "black"),
		text = element_text(colour = "black", size = 15),
		axis.text = element_text(colour = "black")
	)
}
theme_set(theme_custom())

# load data
gaze <- readRDS(here("Data", "Gaze", "d.rds"))
stimuli <- readRDS(here("Data", "Stimuli", "stimuli.rds"))
attrition <- readRDS(here("Results", "attrition.rds")) %>% 
	mutate(
		valid_gaze = valid_gaze_prime & valid_gaze_target,
		valid_status = case_when(
			!valid_vocab ~ "Invalid vocabulary",
			!valid_gaze ~ "Invalid gaze",
			!valid_participant ~ "Invalid participant",
			TRUE ~ "Valid"
		))
vocab <- readRDS(here("Data", "Vocabulary", "vocabulary.rds"))
participants <- readRDS(here("Data", "Participants", "participants.rds")) %>% 
	left_join(distinct(attrition, participant, age_group, valid_participant)) %>% 
	drop_na(participant) %>% 
	left_join(vocab) %>% 
	mutate(vocab_size_l1_center = scale(vocab_size_l1)[,1])
fit <- readRDS(here("Results", "fit.rds"))
fit_21_mon <- readRDS(here("Results", "fit_21_mon.rds"))
fit_21_mon_vocab <- readRDS(here("Results", "fit_21_mon_vocab.rds"))
fit_21_mon_vocab_pct <- readRDS(here("Results", "fit_21_mon_vocab_pct.rds"))
fit_21_mon_location <- readRDS(here("Results", "fit_21_mon_location.rds"))

```


# Methods

## Participants {.tabset .tabpills}

* We collected data from `r length(unique(participants$participant))` participants `r length(unique(participants$participant[participants$location=="Oxford"]))` were tested in Oxford, and `r length(unique(participants$participant[participants$location=="Barcelona"]))` were tested in Barcelona.
* After applying trial- ad participant-level exclusion criteria, the sample comprise data from `r length(unique(participants$participant[participants$valid_participant]))` (`r length(unique(participants$participant[participants$valid_participant & participants$location=="Oxford"]))` tested in Oxford, and `r length(unique(participants$participant[participants$valid_participant & participants$location=="Barcelona"]))` tested in Barcelona), and were included in our analyses.
* `r length(participants$participant[duplicated(participants$participant) & participants$valid_participant])` participants in the final sample were longitudinal (tested in at least one age group). `r length(participants$participant[duplicated(participants$participant) & participants$location=="Oxford" & participants$valid_participant])` longitudinal participants were tested in Oxford and `r length(participants$participant[duplicated(participants$participant) & participants$location=="Barcelona" & participants$valid_participant])` were tested in Barcelona.
* From the longitudinal participants, `r length(participants$participant[(as.data.frame(table(participants$participant))$Freq>2) & participants$valid_participant])` were tested at two age groups, and `r length(participants$participant[(as.data.frame(table(participants$participant))$Freq>2) & participants$valid_participant])`were tested at three age groups.


### Summary

```{r participants_summary, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
participants %>% 
	left_join(distinct(attrition, participant, valid_participant)) %>% 
	filter(valid_participant) %>% 
	drop_na(valid_participant) %>% 
	ggplot(aes(lp, fill = as.factor(test_language))) +
	facet_grid(location~age_group, scales = "free") +
	geom_bar(colour = NA) +
	geom_hline(yintercept = 24, linetype = "dashed") +
	labs(x = "Group", y = "Sample size", fill = "Test language") +
	theme(
		legend.position = "top",
		axis.title.x = element_blank(),
		axis.text = element_text(size = 10),
		axis.title.y = element_text(angle = 90)
	) 
```

### Longitudinal

We collected data from `r sum(duplicated(participants$participant))` longitudinal participants, that is, who were tested in at least two of the three ages (21, 25, and 30). Of those, `r sum(duplicated(participants$participant[participants$location=="Oxford"]))` were tested in Oxford, and `r sum(duplicated(participants$participant[participants$location=="Barcelona"]))` were tested in Barcelona.

```{r participants_cohort, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=6, out.width="100%"}
# plot participants
participants %>% 
	left_join(distinct(attrition, participant, valid_participant)) %>%
	mutate(
		valid_status = case_when(
			valid_participant & !is.na(vocab_size_l1) ~ "Valid (+ CDI)",
			valid_participant & is.na(vocab_size_l1) ~ "Valid (no CDI)",
			!valid_participant ~ "Not valid"
		),
		age_group = str_remove(age_group, " months")
	) %>%
	drop_na(valid_status) %>% 
	ggplot(aes(age_group, participant, colour = valid_status)) +
	facet_grid(location~lp, scales = "free") +
	geom_line(aes(group = interaction(lp, participant))) +
	geom_point(size = 2) +
	geom_hline(yintercept = 0.2, linetype = "dashed") +
	labs(x = "Age (months)", y = "Exposure to 2nd language", fill = "Validity status") +
	theme(
		legend.position = "right",
		legend.title = element_blank(),
		axis.text = element_text(size = 10),
		axis.title.y = element_blank(),
		axis.text.y = element_blank(),
		axis.ticks.y = element_blank()
	)
```



### {-}

## Stimuli {.tabset .tab-pills}

### Frequency {.tabset .tab-pills}

#### CHILDES vs. SUBTLEX


```{r frequencies_compare, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

frequency_compare_data <- bind_rows(
	stimuli %>%
		distinct(test_language, prime, .keep_all = TRUE) %>%
		select(prime, test_language, matches("frequency_prime")) %>% 
		rename(word = prime, frequency_subtlex = frequency_prime_subtlex,
			   frequency_childes = frequency_prime_childes),
	stimuli %>%
		distinct(test_language, target, .keep_all = TRUE) %>%
		select(target, test_language, matches("frequency_target")) %>% 
		rename(word = target, frequency_subtlex = frequency_target_subtlex,
			   frequency_childes = frequency_target_childes),
) %>% 
	group_by(test_language) %>% 
	mutate_at(vars(starts_with("frequency")), function(x) scale(x)[,1])


frequency_compare_test <- group_split(frequency_compare_data) %>% 
	set_names(c("Catalan", "English", "Spanish")) %>% 
	map(function(x) {
		a <- pull(x, frequency_subtlex)
		b <- pull(x, frequency_childes)
		tidy(cor.test(a, b), use = "complete.obs")
	}) %>% 
	bind_rows(.id = "test_language") %>% 
	clean_names()


```


We tested the correlation between the (standardised) lexical frequencies of the stimuli extract from SUBTLEX (adult norms based on subtitles) and CHILDES (child norms based on audio transcriptions) within each test language using a Pearson's product-moment correlation at .05 confidence level (two-sided):

```{r stimuli_frequency_compare_test, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

frequency_compare_test %>% 
	select(test_language, estimate, statistic, parameter, p_value, conf_low, conf_high) %>% 
	mutate(p_value = printp(p_value)) %>% 
	gt(rowname_col = "test_language") %>% 
	fmt_number(c(2, 3, 6, 7), decimals = 2) %>% 
	cols_merge(c("conf_low", "conf_high"), pattern = "{1}, {2}") %>% 
	cols_label(
		estimate = md("**Correlation**"),
		statistic = md("***t***"),
		parameter = md("***df***"),
		p_value = md("***p***"),
		conf_low = md("**CI<sub>95%<sub/>**")
	)

```


```{r stimuli_frequency_compare_plot, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}

frequency_compare_data %>% 
	ggplot(aes(frequency_subtlex, frequency_childes, colour = test_language, fill = test_language)) +
	facet_wrap(~test_language) +
	geom_point(alpha = 0.5, stroke = 1, shape = 1) +
	geom_smooth(method = "lm") +
	labs(x = "SUBTLEX (adult norms)", y = "CHILDES (child norms)",
		 colour = "Language", fill = "Language") +
	coord_fixed() +
	theme(
		legend.position = "none",
		legend.title = element_blank(),
		axis.text = element_text(size = 9),
		axis.title.x = element_blank(),
		panel.grid.major.y = element_line(colour = "grey", linetype = "dotted"),
		plot.caption = element_text(size = 10, hjust = 0),
	)

```

#### CHILDES {.tabset .tab-pills}

##### Prime

```{r stimuli_frequency_childes_prime, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, fig.height=5, out.width="80%"}

stimuli %>% 
	distinct(location, test_language, target, prime, .keep_all = TRUE) %>% 
	ggplot(aes(trial_type, frequency_prime_childes, colour = trial_type, fill = trial_type)) +
	facet_wrap(location~test_language) +
	geom_violin() +
	geom_boxplot(colour = "black", fill = "white", outlier.colour = NA, width = 0.1) +
	geom_jitter(colour = "black", size = 1, shape = 1,
				width = 0.1, alpha = 0.5, stroke = 1) +
	labs(x = "Trial type", y = "Lexical frequency (Zipf score)",
		 colour = "Trial type", fill = "Trial type") +
	theme(
		legend.position = "none",
		legend.title = element_blank(),
		axis.text = element_text(size = 9),
		axis.title.x = element_blank(),
		panel.grid.major.y = element_line(colour = "grey", linetype = "dotted"),
		plot.caption = element_text(size = 10, hjust = 0),
	)

```

##### Target

```{r stimuli_frequency_childes_target, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, fig.height=5, out.width="80%"}

stimuli %>% 
	distinct(location, test_language, target, prime, .keep_all = TRUE) %>% 
	ggplot(aes(trial_type, frequency_target_childes, colour = trial_type, fill = trial_type)) +
	facet_wrap(location~test_language) +
	geom_violin() +
	geom_boxplot(colour = "black", fill = "white", outlier.colour = NA, width = 0.1) +
	geom_jitter(colour = "black", size = 1, shape = 1,
				width = 0.1, alpha = 0.5, stroke = 1) +
	labs(x = "Trial type", y = "Lexical frequency (Zipf score)",
		 colour = "Trial type", fill = "Trial type") +
	theme(
		legend.position = "none",
		legend.title = element_blank(),
		axis.text = element_text(size = 9),
		axis.title.x = element_blank(),
		panel.grid.major.y = element_line(colour = "grey", linetype = "dotted"),
		plot.caption = element_text(size = 10, hjust = 0),
	)
```

##### {-}

#### SUBTLEX {.tabset .tab-pills}

##### Prime

```{r stimuli_frequency_subtlex_prime, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, fig.height=5, out.width="80%"}

stimuli %>% 
	distinct(location, test_language, target, prime, .keep_all = TRUE) %>% 
	ggplot(aes(trial_type, frequency_prime_subtlex, colour = trial_type, fill = trial_type)) +
	facet_wrap(location~test_language) +
	geom_violin() +
	geom_boxplot(colour = "black", fill = "white", outlier.colour = NA, width = 0.1) +
	geom_jitter(colour = "black", size = 1, shape = 1,
				width = 0.1, alpha = 0.5, stroke = 1) +
	labs(x = "Trial type", y = "Lexical frequency (Zipf score)",
		 colour = "Trial type", fill = "Trial type") +
	theme(
		legend.position = "none",
		legend.title = element_blank(),
		axis.text = element_text(size = 9),
		axis.title.x = element_blank(),
		panel.grid.major.y = element_line(colour = "grey", linetype = "dotted"),
		plot.caption = element_text(size = 10, hjust = 0),
	)

```

##### Target

```{r stimuli_frequency_subtlex_target, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, fig.height=5, out.width="80%"}

stimuli %>% 
	distinct(location, test_language, target, prime, .keep_all = TRUE) %>% 
	ggplot(aes(trial_type, frequency_target_subtlex, colour = trial_type, fill = trial_type)) +
	facet_wrap(location~test_language) +
	geom_violin() +
	geom_boxplot(colour = "black", fill = "white", outlier.colour = NA, width = 0.1) +
	geom_jitter(colour = "black", size = 1, shape = 1,
				width = 0.1, alpha = 0.5, stroke = 1) +
	labs(x = "Trial type", y = "Lexical frequency (Zipf score)",
		 colour = "Trial type", fill = "Trial type") +
	theme(
		legend.position = "none",
		legend.title = element_blank(),
		axis.text = element_text(size = 9),
		axis.title.x = element_blank(),
		panel.grid.major.y = element_line(colour = "grey", linetype = "dotted"),
		plot.caption = element_text(size = 10, hjust = 0),
	)
```

##### {-}

#### {-}

### Familiarity {.tabset .tab-pills}

#### Prime

```{r stimuli_familiarity_prime, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, fig.height=7, out.width="100%"}
means <- stimuli %>% 
	distinct(location, test_language, target, trial_type, prime, .keep_all = TRUE) %>% 
	group_by(test_language, location, trial_type) %>% 
	summarise(
		familiarity_prime = mean(familiarity_prime, na.rm = TRUE),
		.groups = "drop"
	) %>% 
	drop_na()

stimuli %>% 
	distinct(location, test_language, target, prime, .keep_all = TRUE) %>% 
	ggplot(aes(familiarity_prime, reorder(prime, familiarity_prime), xmin = familiarity_ci_lower_prime, xmax = familiarity_ci_upper_prime, colour = trial_type, fill = trial_type)) +
	facet_wrap(location~test_language, scales = "free_y") +
	geom_vline(xintercept = 0.5, size = 1, colour = "grey") +
	geom_vline(data = means, aes(xintercept = familiarity_prime, colour = trial_type), size = 1) +
	geom_errorbar() +
	geom_point() +
	labs(x = "% of infants that understand", y = "Prime word",
		 colour = "Trial type", fill = "Trial type") +
	scale_x_continuous(labels = percent) +
	theme_custom() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text = element_text(size = 10),
		axis.title.y = element_blank(),
		plot.caption = element_text(size = 10, hjust = 0),
	)

```

#### Target

```{r stimuli_familiarity_target, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, fig.height=6, out.width="100%"}
means <- stimuli %>% 
	distinct(location, test_language, target, trial_type, prime, .keep_all = TRUE) %>% 
	group_by(test_language, location, trial_type) %>% 
	summarise(
		familiarity_target = mean(familiarity_target, na.rm = TRUE),
		.groups = "drop"
	) 

stimuli %>% 
	distinct(location, test_language, target, prime, .keep_all = TRUE) %>% 
	ggplot(aes(familiarity_target, reorder(target, familiarity_target), xmin = familiarity_ci_lower_target, xmax = familiarity_ci_upper_target, colour = trial_type, fill = trial_type)) +
	facet_wrap(location~test_language, scales = "free_y") +
	geom_vline(xintercept = 0.5, size = 1, colour = "grey") +
	geom_vline(data = means, aes(xintercept = familiarity_target, colour = trial_type), size = 1) +
	geom_errorbar() +
	geom_point() +
	labs(x = "% of infants that understand", y = "Target word",
		 colour = "Trial type", fill = "Trial type") +
	scale_x_continuous(labels = percent) +
	theme_custom() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text = element_text(size = 10),
		axis.title.y = element_blank(),
		plot.caption = element_text(size = 10, hjust = 0),
	)


```


#### {-}


### Animacy

```{r stimuli_animacy, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, fig.height=6, out.width="100%"}

animacy <- stimuli %>%
	distinct(location, test_language, target, prime, .keep_all = TRUE) %>% 
	pivot_longer(c(is_animate_prime, is_animate_target), names_to = "role", values_to = "is_animate") %>% 
	mutate(role = str_to_sentence(str_remove(role, "is_animate_"))) %>% 
	count(location, test_language, trial_type, role, is_animate) %>% 
	drop_na(is_animate) %>% 
	mutate(is_animate = ifelse(is_animate, "Animate", "Inanimate"))


animacy %>% 
	filter(role=="Prime") %>% 
	ggplot(aes(trial_type, n, fill = is_animate, colour = is_animate)) +
	facet_wrap(location~test_language, ncol = 4) +
	geom_col(position = position_fill(), colour = "white") +
	geom_vline(xintercept = 0.5, size = 1, colour = "grey") +
	labs(title = "Prime", x = "Trial type", y = "# trials", colour = "Animacy", fill = "Animacy") +
	scale_y_continuous(labels = percent) +
	coord_flip() + 
	theme(
		axis.title.x = element_blank()
	) +
	
	animacy %>% 
	filter(role=="Target") %>% 
	ggplot(aes(trial_type, n, fill = is_animate, colour = is_animate)) +
	facet_wrap(location~test_language, ncol = 4) +
	geom_col(position = position_fill(), colour = "white") +
	geom_vline(xintercept = 0.5, size = 1, colour = "grey") +
	labs(title = "Target", x = "Trial type", y = "# trials", colour = "Animacy", fill = "Animacy") +
	scale_y_continuous(labels = percent) +
	coord_flip() +
	
	plot_layout(guides = "collect", ncol = 1) &
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.title.y = element_blank(),
		axis.text = element_text(size = 10),
		strip.text = element_text(size = 11)
	)


```

### Semantic category

```{r stimuli_category, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, fig.height=6, out.width="100%"}

stimuli %>% 
	distinct(location, test_language, target, prime, .keep_all = TRUE) %>% 
	pivot_longer(c(category_prime, category_target), names_to = "role", values_to = "category") %>% 
	mutate(role = str_to_sentence(str_remove(role, "_category"))) %>% 
	drop_na() %>% 
	count(trial_type, test_language, location, role, category) %>% 
	ggplot(aes(n, trial_type, colour = category, fill = category, order = n)) +
	facet_grid(role~location~test_language) +
	geom_col(position = position_fill()) +
	labs(x = "% of trials", y = "Trial type",
		 colour = "Trial type", fill = "Trial type") +
	scale_fill_manual(values = wes_palette(name = "Zissou1", n = 9, type = "continuous")) +
	scale_colour_manual(values = wes_palette(name = "Zissou1", n = 9, type = "continuous")) +
	scale_x_continuous(labels = percent) +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text = element_text(size = 9),
		axis.title.y = element_blank(),
		plot.caption = element_text(size = 10, hjust = 0),
	)

```


### {-}

## Procedure

## Data analysis

### Vocabulary data

We collected vocabulary data from participants. In Oxford, participants were sent the online version of the Oxford Communicative Development Inventory [OCDI; @hamilton2000] two weeks before each appointment. In Barcelona, participants were sent the online vocabulary inventory [MultiLex](https://github.com/gongcastro/multilex) immediately after the appointment, and were given two weeks to fill it. In Oxford, families filled the vocabulary checklist in the testing language, and when the participant was monolingual, also in the second language. In Barcelona, all participants filled the Catalan and the Spanish versions of the vocabulary checklists. All checklists included the words involved in the trial lists. When filling the vocabulary checklist, families checked each word as being *understood*, *understood and produced* or *none*. Each response to either checklist was aggregated to produce several vocabulary measures:

* **Total vocabulary**: total number of words the child knows, summing up both languages. For instance, a child who knows 210 words in Catalan and 100 words in Spanish would have a total vocabulary size of 210 words.
* **L1 vocabulary**: number of words the child knows in the languages of higher exposure (i.e., testing language). For instance, for a child exposed to 75% Catalan who knows 210 words in Catalan and 100 words in Spanish, their L1 vocabulary size would be 210 words.
* **Conceptual vocabulary**: number of lexicalised concepts, that is, the number of concepts for which the child knows a word in at least one of the languages. For example, a Catalan-Spanish bilingual that knows *taula* and *mesa* -- Catalan and Spanish translations of *table*-- would have a conceptual vocabulary size of 1.

Vocabulary sizes of participants whose families failed to complete the vocabulary checklists were imputed, by assigning them the most likely vocabulary size from a distribution of vocabulary sizes of children of similar age ($\pm$ 1 month) and language profile (similar exposure to a second language, $\pm$ 10%) that completed the same vocabulary checklist previously.


## Gaze data {.tabset .tabset-pills}

Each trial was divided into 100 ms time bins. for each time bin, the proportion of  target fixations were calculated, from the total of fixations to the target, distractor and the rest of the screen for that same time bin. Proportions were then aggregated across trials for each time bin and participants, so that each participant contributed with 20 data points (one for each time bin) for each trial type (cognate, non-cognate, and unrelated).

### Workflow

```{r workflow_preprocessing, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
DiagrammeR::grViz("digraph {
  graph [layout = dot, rankdir = TB]
  
  node [shape = rectangle, fontname = 'Arial']        
  rec1 [label = 'Merge Barcelona and Oxford data']
  rec2 [label = 'Impute missing/invalid samples (pending)']
  rec2 [label = 'Extract fixations (pending)']
  rec3 [label = 'For each sample, evaluate if gaze is in target or distractor']
  rec4 [label = 'Divide each trial into 100 ms time bins']
  rec5 [label = 'Aggregate samples from the same time bin and calculate\nthe number of valid samples in target, distractor, or none']
  rec6 [label = 'Exclude time bins 1-3 (pending)']
  rec7 [label = 'Apply trial-level inclusion criteria']
  rec8 [label = 'Apply participant-level inclusion criteria']

  
  # edge definitions with the node IDs
  rec1 -> rec2 -> rec3 -> rec4 -> rec5 -> rec6 -> rec7 -> rec8
  }", 
  height = 500)
```


### Inclusion criteria

#### Trial-level inclusion criteria

* $\geq$ 50% or more valid samples during prime phase (1,500 ms)
* $\geq$ 50% or more valid samples during target-distractor phase (2,000 ms)
* At least one sample in target and one sample in distractor
* Participant understands prime word in both languages
* Participant knows the target word in the test language
* Participant knows the distractor word in the test language

#### Participant-level inclusion criteria

* $\geq$ 4 trials in *Cognate* condition (50%, from a total of 8)
* $\geq$ 4 trials in *Non-cognate* condition (50%, from a total of 8)
* $\geq$ 8 trials in *Unrelated* condition (50%, from a total of 16)
* $\geq$ 36 gestational weeks
* $\geq$ 2,800g birth weight
* No diagnosed developmental, hearing, or visual disorders
* Not exposed to more than 10% to a 3rd language


### Input variables

* Linear (`ot1`), quadratic (`ot2`), and cubic (`ot3`) orthogonal polynomials of the time domain [@mirman2014growth].
* Language profile (`lp`). Categorical predictor with two levels: *Monolingual* and *Bilingual*. Sum coded as *Monolingual* = -0.5, *Bilingual* = +0.5.
* Trial type (`trial_type1` and `trial_type2`). Categorical predictor with three levels: *Cognate*, *Non-cognate*, and *Unrelated*. We coded two contrasts: `trial_type1`, comparing related trials vs. unrelated trials (*Cognate* + *Non-cognate* vs. *Unrelated*), and `trial_type2`, comparing *Cognate* vs. *Non-cognate* trials. These contrasts were sum-coded (see next table for a summary of the contrast coding) [@schad2018capitalize].


```{r contrasts, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

contrasts(gaze$trial_type) %>% 
	as.data.frame() %>% 
	set_names(paste0("trial_type", 1:2)) %>% 
	rownames_to_column("level") %>% 
	gt(rowname_col = "level")

```


### {-}

## {-}


# Results {.tabset .tab-pills}


## Raw data

```{r, echo = FALSE}
shinyAppFile(
	here("R", "gaze_app", "app.R"), 
	options = list(width = "100%", height = 700)
)
```


## Growth curve analysis {.tabset .tab-pills}


### Model details

We fit a multilevel regression model using the `lmer` function of the `lme4` package, used the following formula:

```
elog ~ age_group + trial_type * lp * (ot1 + ot2 + ot3) +
(1 + ot1 + ot2 + ot3 + trial_type + age_group | participant)
```

The formal implementation of this model is:

$$
\log(\frac{p}{n - q}) = (\beta_{0} + \beta_{0p} + \beta_{0i}) + ... \\
(\beta_{1} + \beta_{1p} + \beta_{1i}) \times Age_{pi} + ... \\
(\beta_{2} + \beta_{2p} + \beta_{2i}) \times Vocabulary_{pi} + ... \\
(\beta_{3} + \beta_{3p} + \beta_{3i})\times Condition_{pi} + ... \\
(\beta_{4} + \beta_{4i}) \times Group_{pi} + ... \\
(\beta_{5} + \beta_{5i}) \times (Vocabulary_{pi} \times Group_{pi}) + ... \\
(\beta_{6} + \beta_{6i}) \times (Vocabulary_{pi} \times Condition_{pi}) + ... \\
(\beta_{7} + \beta_{7i}) \times (Condition_{pi} \times Group_{pi}) + ... \\
(\beta_{8} + \beta_{8i}) \times (Vocabulary_{pi} \times Group_{pi} \times Condition_{pi}) + \varepsilon_{pi}
$$

### Fixed effects

```{r fixed_effects_table, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
main_effects <- confint.merMod(fit, method = "Wald") %>% 
	as.data.frame() %>% 
	clean_names() %>% 
	drop_na(x2_5_percent) %>%
	rownames_to_column("term") %>% 
	right_join(clean_names(tidy(fit, effects = "fixed"))) %>% 
	select(term, estimate, std_error, conf_lower = x2_5_percent, conf_upper = x97_5_percent,
		   statistic, df, p_value) %>% 
	gt() %>% 
	fmt_number(2:7) %>% 
	fmt_number(8, decimals = 3) %>% 
	cols_merge(starts_with("conf_"), pattern = "[{1}, {2}]") %>% 
	cols_label(
		term = md("**Predictor**"),
		estimate = md("**Estimate**"),
		std_error = md("**SE**"),
		conf_lower = md("**CI<sub>95%</sub>**"),
		statistic = md("***t***"),
		df = md("**df**"),
		p_value = md("***p***")
	) %>% 
	tab_style(
		style = list(
			cell_fill(color = "#ffc7a1")
		),
		locations = cells_body(
			columns = everything(),
			rows = p_value < 0.05
		)
	)

main_effects
```


### Random effects

```{r random_effects_participant, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

VarCorr(fit)$participant %>% 
	cov2cor() %>% 
	as.data.frame() %>% 
	rownames_to_column("term1") %>% 
	gt(rowname_col = "term1") %>% 
	fmt_number(columns = 2:9) %>% 
	data_color(
		columns = 2:9,
		colors = col_numeric(
			palette = RColorBrewer::brewer.pal(n = 9, name = "Oranges"),
			domain = c(-1, 1), alpha = 0.5
		)
	)

```


### Marginal means {.tabset .tab-pills}

#### Overall

```{r gaze_time, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
sample_size <- participants %>% 
	filter(valid_participant) %>% 
	count(age_group, lp)

augment(fit) %>% 
	mutate(.fitted_prob = logit_to_prob(.fitted)) %>% 
	ggplot() +
	facet_grid(lp~age_group) +
	geom_hline(yintercept = 0.5, size = 1, colour = "grey") +
	stat_summary(aes(x = ot1, y = .fitted_prob, colour = trial_type, fill = trial_type),
				 fun.data = mean_se, geom = "ribbon", alpha = 0.5, colour = NA) +
	stat_summary(aes(x = ot1, y = .fitted_prob, colour = trial_type, fill = trial_type),
				 fun = mean, geom = "line", size = 1) +
	# stat_summary(fun.data = mean_se, geom = "pointrange", size = 0.25) +
	geom_text(data = sample_size,
			  aes(x = -0.3, y = 0.95, label = paste0("n = ", n)),
			  show.legend = FALSE,
			  colour = "black", fill = "black") +
	labs(x = "Time bin (100 ms)", y = "Prob. of target fixation",
		 colour = "Trial type", fill = "Trial type",
		 caption = "Marginal means of the multilevel model, plotted in separate panels for monolinguals and bilinguals, across age\ngroups. Sample sizes are indicated at the upper left corner in each panel. The first and last 300 ms in each trial\nwere trimmed before the analysis.") +
	scale_y_continuous(limits = c(0, 1), labels = percent) + 
	scale_x_continuous(breaks = unique(gaze$ot1), labels = unique(gaze$time_bin)) +
	theme_custom() +
	theme(
		legend.position = "top",
		axis.text = element_text(size = 7),
		plot.caption = element_text(size = 10, hjust = 0),
		plot.caption.position = "plot"
	) 
```


#### By vocabulary size


```{r gaze_time_vocab_lower, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
sample_size <- participants %>% 
	count(age_group, lp)

augment(fit) %>% 
	mutate(.fitted_prob = logit_to_prob(.fitted)) %>% 
	filter(vocab_size_l1_center <= median(.$vocab_size_l1_center)) %>% 
	ggplot(aes(x = ot1, y = .fitted_prob)) +
	facet_grid(lp~age_group) +
	geom_hline(yintercept = 0.5, size = 1, colour = "grey") +
	stat_summary(aes(y = .fitted_prob, colour = trial_type, fill = trial_type), fun.data = mean_se, geom = "ribbon", alpha = 0.5, colour = NA) +
	stat_summary(aes(y = .fitted_prob, colour = trial_type, fill = trial_type), fun = mean, geom = "line", size = 1) +
	geom_text(data = sample_size,
			  aes(x = -0.3, y = 0.95, label = paste0("n = ", n)),
			  show.legend = FALSE,
			  colour = "black", fill = "black") +
	# stat_summary(fun.data = mean_se, geom = "pointrange", size = 0.25) +
	labs(x = "Time bin (100 ms)", y = "Prob. of target fixation",
		 colour = "Trial type", fill = "Trial type",
		 title = "Vocabulary size <= median") +
	scale_y_continuous(limits = c(0, 1)) + 
	scale_x_continuous(breaks = unique(gaze$ot1), labels = unique(gaze$time_bin)) +
	theme(
		legend.position = "top",
		axis.text = element_text(size = 7)
	)
```


```{r gaze_time_vocab_upper, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
sample_size <- participants %>% 
	filter(vocab_size_l1_center > median(.$vocab_size_l1_center, na.rm = TRUE), valid_participant) %>% 
	count(age_group, lp)

augment(fit) %>% 
	mutate(.fitted_prob = logit_to_prob(.fitted)) %>% 
	filter(vocab_size_l1_center > median(.$vocab_size_l1_center)) %>% 
	ggplot(aes(x = ot1, y = .fitted_prob)) +
	facet_grid(lp~age_group) +
	geom_hline(yintercept = 0.5, size = 1, colour = "grey") +
	stat_summary(aes(y = .fitted_prob, colour = trial_type, fill = trial_type), fun.data = mean_se, geom = "ribbon", alpha = 0.5, colour = NA) +
	stat_summary(aes(y = .fitted_prob, colour = trial_type, fill = trial_type), fun = mean, geom = "line", size = 1) +
	geom_text(data = sample_size,
			  aes(x = -0.3, y = 0.95, label = paste0("n = ", n)),
			  show.legend = FALSE,
			  colour = "black", fill = "black") +
	# stat_summary(fun.data = mean_se, geom = "pointrange", size = 0.25) +
	labs(x = "Time bin (100 ms)", y = "Prob. of target fixation",
		 colour = "Trial type", fill = "Trial type",
		 title = "Vocabulary size > median") +
	scale_y_continuous(limits = c(0, 1)) + 
	scale_x_continuous(breaks = unique(gaze$ot1), labels = unique(gaze$time_bin)) +
	theme(
		legend.position = "top",
		axis.text = element_text(size = 7)
	)
```



#### By location

```{r gaze_time_location_barcelona, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
sample_size <- participants %>% 
	filter(location=="Barcelona", valid_participant) %>% 
	count(age_group, lp)

augment(fit) %>% 
	left_join(distinct(participants, participant, location)) %>% 
	mutate(.fitted_prob = logit_to_prob(.fitted)) %>% 
	filter(location=="Barcelona") %>% 
	ggplot(aes(x = ot1, y = .fitted_prob)) +
	facet_grid(lp~age_group) +
	geom_hline(yintercept = 0.5, size = 1, colour = "grey") +
	stat_summary(aes(y = .fitted_prob, colour = trial_type, fill = trial_type), fun.data = mean_se, geom = "ribbon", alpha = 0.5, colour = NA) +
	stat_summary(aes(y = .fitted_prob, colour = trial_type, fill = trial_type), fun = mean, geom = "line", size = 1) +
	geom_text(data = sample_size,
			  aes(x = -0.3, y = 0.95, label = paste0("n = ", n)),
			  show.legend = FALSE,
			  colour = "black", fill = "black") +
	# stat_summary(fun.data = mean_se, geom = "pointrange", size = 0.25) +
	labs(x = "Time bin (100 ms)", y = "Prob. of target fixation",
		 colour = "Trial type", fill = "Trial type",
		 title = "Barcelona") +
	scale_y_continuous(limits = c(0, 1)) + 
	scale_x_continuous(breaks = unique(gaze$ot1), labels = unique(gaze$time_bin)) +
	theme(
		legend.position = "top",
		axis.text = element_text(size = 7)
	)
```


```{r gaze_time_location_oxford, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
sample_size <- participants %>% 
	filter(location=="Oxford") %>% 
	count(age_group, lp)

augment(fit) %>% 
	left_join(distinct(participants, participant, location)) %>% 
	mutate(.fitted_prob = logit_to_prob(.fitted)) %>% 
	filter(location=="Oxford") %>% 
	ggplot(aes(x = ot1, y = .fitted_prob)) +
	facet_grid(lp~age_group) +
	geom_hline(yintercept = 0.5, size = 1, colour = "grey") +
	stat_summary(aes(y = .fitted_prob, colour = trial_type, fill = trial_type), fun.data = mean_se, geom = "ribbon", alpha = 0.5, colour = NA) +
	stat_summary(aes(y = .fitted_prob, colour = trial_type, fill = trial_type), fun = mean, geom = "line", size = 1) +
	geom_text(data = sample_size,
			  aes(x = -0.3, y = 0.95, label = paste0("n = ", n)),
			  show.legend = FALSE,
			  colour = "black", fill = "black") +
	# stat_summary(fun.data = mean_se, geom = "pointrange", size = 0.25) +
	labs(x = "Time bin (100 ms)", y = "Prob. of target fixation",
		 colour = "Trial type", fill = "Trial type",
		 title = "Oxford") +
	scale_y_continuous(limits = c(0, 1)) + 
	scale_x_continuous(breaks = unique(gaze$ot1), labels = unique(gaze$time_bin)) +
	theme(
		legend.position = "top",
		axis.text = element_text(size = 7)
	)
```

#### {-}


### {-}


## Attrition {.tabset .tab-pills}


### Summary


```{r participants_cdi, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
# plot participants
participants %>% 
	left_join(distinct(attrition, participant, valid_participant)) %>%
	left_join(vocab) %>% 
	drop_na(valid_participant) %>% 
	mutate(
		valid_status = case_when(
			valid_participant & !is.na(vocab_size_l1) ~ "Valid (+ CDI)",
			valid_participant & is.na(vocab_size_l1) ~ "Valid (no CDI)",
			!valid_participant ~ "Not valid"
		)
	) %>% 
	ggplot(aes(lp, fill = valid_status)) +
	facet_grid(location~age_group, scales = "free") +
	geom_bar(colour = NA) +
	geom_hline(yintercept = 24, linetype = "dashed") +
	scale_colour_brewer(palette = "Set1") +
	labs(x = "Group", y = "Sample size", fill = "Valid?") +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.title.x = element_blank(),
		axis.text = element_text(size = 10),
		axis.title.y = element_text(angle = 90)
	) 
```


### By location

```{r trials_attrition_location, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=8, out.width="100%"}
# plot participants
attrition_location <- attrition %>% 
	left_join(select(participants, participant, location)) %>% 
	count(location, lp, age_group, trial_type, valid_status) %>% 
	drop_na(trial_type)

attrition_location %>% 
	filter(location=="Barcelona") %>% 
	ggplot(aes(trial_type, n, fill = valid_status, colour = valid_status)) +
	facet_grid(lp~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity", title = "Barcelona") +
	
	attrition_location %>% 
	filter(location=="Oxford") %>% 
	ggplot(aes(trial_type, n, fill = valid_status, colour = valid_status)) +
	facet_grid(lp~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity", title = "Oxford") +
	
	plot_layout(guides = "collect", ncol = 1) &
	scale_y_continuous(labels = percent) &
	coord_flip() &
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 10),
		axis.title = element_blank()
	)
```

### By group


This table shows a summary of the total, total valid, and proportion of valid monolingual and bilingual participants tested in each lab (Barcelona and Oxford), in each age group (21, 25, and 30 months), and the mean of valid trials they contributed in each trial type (cognate, non-cognate, and unrelated). 


```{r attrition, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=12}

left_join(attrition, select(participants, age_group, location, lp, participant, date_test)) %>% 
	group_by(participant, lp, location, trial_type, date_test, age_group, valid_participant) %>% 
	summarise(valid_trial_count = sum(valid_trial, na.rm = TRUE),
			  .groups = "drop") %>% 
	pivot_wider(
		names_from = trial_type,
		values_from = valid_trial_count
	) %>% 
	clean_names() %>% 
	group_by(lp, location, age_group) %>% 
	summarise(
		cognate = mean(cognate, na.rm = TRUE),
		non_cognate = mean(non_cognate, na.rm = TRUE),
		unrelated = mean(unrelated, na.rm = TRUE),
		sum_n = sum(valid_participant, na.rm = TRUE),
		prop_n = mean(valid_participant, na.rm = TRUE),
		n = n(),
		.groups = "drop"
	) %>% 
	arrange(age_group, lp, location) %>% 
	relocate(age_group, lp, location, cognate, non_cognate, unrelated, sum_n, n, prop_n) %>% 
	gt() %>% 
	tab_spanner(
		"Mean valid trials",
		c("cognate", "non_cognate", "unrelated")
	) %>% 
	tab_spanner(
		"N participants",
		c("sum_n", "n", "prop_n")
	) %>% 
	cols_label(
		age_group = "Age",
		lp = "Group",
		sum_n = "Valid",
		location = "Laboratory",
		n = "Tested",
		prop_n = "Valid (%)",
		cognate = "Cognate (8)",
		non_cognate = "Non-cognate (8)",
		unrelated = "Unrelated (16)"
	) %>% 
	fmt_number(c("cognate", "non_cognate", "unrelated")) %>%
	fmt_percent(c("prop_n")) %>% 
	fmt_number(c("n", "sum_n"), decimals = 0)

```


### By participant


```{r participants_attrition, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
# plot participants
attrition %>% 
	left_join(select(participants, participant, location)) %>% 
	mutate(participant = str_remove(participant, "cognatepriming")) %>% 
	group_by(location, participant, lp, age_group, valid_participant) %>% 
	summarise(
		valid = mean(valid_trial),
		invalid_gaze = mean(!valid_gaze),
		invalid_vocab = mean(!valid_vocab),
		.groups = "drop"
	) %>% 
	relocate(participant) %>% 
	gt() %>% 
	tab_spanner(label = "Invalid trials", columns = starts_with("invalid_")) %>% 
	cols_label(
		participant = "Participant",
		location = "Location",
		lp = "Lang. Profile",
		age_group = "Age",
		valid_participant = "Valid participant",
		valid = "Valid trials (%)",
		invalid_gaze = "Gaze (%)",
		invalid_vocab = "Vocabulary (%)"
	) %>% 
	fmt_percent(c("valid", "invalid_gaze", "invalid_vocab")) %>% 
	div(style='height:600px; overflow-y: scroll', .)
```


### By trial


```{r trials_attrition_table, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
# plot participants
attrition %>% 
	left_join(select(participants, participant, location)) %>% 
	group_by(location, lp, age_group, trial_type, valid_trial) %>% 
	count() %>% 
	ungroup() %>%
	mutate(valid_trial = ifelse(valid_trial, "Valid", "Not valid")) %>% 
	pivot_wider(names_from = c(age_group, valid_trial), values_from = n, values_fill = 0) %>% 
	clean_names() %>% 
	gt(groupname_col = c("location", "lp")) %>% 
	tab_spanner(label = "21 months", columns = contains("21_")) %>% 
	tab_spanner(label = "25 months", columns = contains("25_")) %>% 
	tab_spanner(label = "30 months", columns = contains("30_")) %>% 
	cols_label(
		location = "Location",
		lp = "Group",
		trial_type = "Trial type",
		x21_months_not_valid = "Not valid",
		x21_months_valid = "Valid",
		x25_months_not_valid = "Not valid",
		x25_months_valid = "Valid",
		x30_months_not_valid = "Not valid",
		x30_months_valid = "Valid"
	)


```


```{r trials_attrition, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
# plot participants
attrition %>% 
	left_join(select(participants, participant, location)) %>% 
	count(location, lp, age_group, trial_type, valid_status) %>% 
	drop_na(trial_type) %>% 
	ggplot(aes(trial_type, n, fill = valid_status, colour = valid_status)) +
	facet_grid(lp~age_group) +
	geom_col(position = position_fill()) +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	scale_y_continuous(labels = percent) +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(angle = 20, hjust = 1, vjust = 1, size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```


### By lexical frequency {.tabset .tab-pills}

#### Prime frequency

```{r attirion_summary, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
# plot participants
attrition %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, frequency_prime_childes)) %>% 
	drop_na(trial_type, frequency_prime_childes) %>% 
	mutate(frequency_prime_childes = round(frequency_prime_childes)) %>% 
	count(trial_type, age_group, valid_status, trial_type, frequency_prime_childes) %>% 
	ggplot(aes(as.factor(frequency_prime_childes), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```

#### Target frequency


```{r attrition_frequency_target, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
attrition %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, frequency_target_childes)) %>% 
	drop_na(trial_type, frequency_target_childes) %>% 
	mutate(frequency_target_childes = round(frequency_target_childes)) %>% 
	count(trial_type, age_group, valid_status, trial_type, frequency_target_childes) %>% 
	ggplot(aes(as.factor(frequency_target_childes), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```

#### {-}

### By familiarity {.tabset .tab-pills}

#### Prime familiarity

```{r attrition_familiarity_prime, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
# plot participants
attrition %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, familiarity_prime)) %>% 
	drop_na(trial_type, familiarity_prime) %>% 
	mutate(familiarity_prime = round(familiarity_prime, digits = 1)) %>% 
	count(trial_type, age_group, valid_status, trial_type, familiarity_prime) %>% 
	ggplot(aes(as.factor(familiarity_prime), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_x_discrete(labels = function(x) paste0(as.numeric(x)*100, "%")) +
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```

#### Target familiarity


```{r attrition_familiarity_target, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
# plot participants
attrition %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, familiarity_target)) %>% 
	drop_na(trial_type, familiarity_target) %>% 
	mutate(familiarity_target = round(familiarity_target, digits = 1)) %>% 
	count(trial_type, age_group, valid_status, trial_type, familiarity_target) %>% 
	ggplot(aes(as.factor(familiarity_target), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_x_discrete(labels = function(x) paste0(as.numeric(x)*100, "%")) +
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```

#### {-}


### By animacy {.tabset .tab-pills}


#### Prime

```{r attrition_animacy_prime, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
attrition %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, is_animate_prime)) %>%
	mutate(is_animate_prime = ifelse(is_animate_prime, "Animate", "Inanimate")) %>% 
	drop_na(trial_type, is_animate_prime) %>% 
	count(trial_type, location, age_group, valid_status, trial_type, is_animate_prime) %>% 
	ggplot(aes(as.factor(is_animate_prime), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)

```


#### Target


```{r attrition_animacy_target, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
attrition %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, is_animate_target)) %>%
	mutate(is_animate_target = ifelse(is_animate_target, "Animate", "Inanimate")) %>% 
	drop_na(trial_type, is_animate_target) %>% 
	count(trial_type, age_group, valid_status, trial_type, is_animate_target) %>% 
	ggplot(aes(as.factor(is_animate_target), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)

```

#### {-}


### By category {.tabset .tab-pills}

#### Prime

```{r attrition_category_prime, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
attrition %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, category_prime)) %>%
	drop_na(trial_type, category_prime) %>% 
	count(trial_type, age_group, valid_status, trial_type, category_prime) %>% 
	ggplot(aes(fct_rev(category_prime), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```

#### Target

```{r attrition_category_target, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
attrition %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, category_target)) %>%
	drop_na(trial_type, category_target) %>% 
	count(trial_type, age_group, valid_status, trial_type, category_target) %>% 
	ggplot(aes(fct_rev(category_target), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```

### {-}


## 21 month-old monolinguals {.tabset .tab-pills}


### All data

```{r fixef_21_mon, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
main_effects <- confint.merMod(fit_21_mon, method = "Wald") %>% 
	as.data.frame() %>% 
	clean_names() %>% 
	drop_na(x2_5_percent) %>%
	rownames_to_column("term") %>% 
	right_join(clean_names(tidy(fit_21_mon, effects = "fixed"))) %>% 
	select(term, estimate, std_error, conf_lower = x2_5_percent, conf_upper = x97_5_percent,
		   statistic, df, p_value) %>% 
	gt() %>% 
	fmt_number(2:7) %>% 
	fmt_number(8, decimals = 3) %>% 
	cols_merge(starts_with("conf_"), pattern = "[{1}, {2}]") %>% 
	cols_label(
		term = md("**Predictor**"),
		estimate = md("**Estimate**"),
		std_error = md("**SE**"),
		conf_lower = md("**CI<sub>95%</sub>**"),
		statistic = md("***t***"),
		df = md("**df**"),
		p_value = md("***p***")
	) %>% 
	tab_style(
		style = list(
			cell_fill(color = "#ffc7a1")
		),
		locations = cells_body(
			columns = everything(),
			rows = p_value < 0.05
		)
	)

main_effects

```


```{r gaze_time_21_mon, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
sample_size <- participants %>% 
	filter(valid_participant, age_group=="21 months", lp=="Monolingual") %>% 
	count(age_group, lp)

augment(fit_21_mon) %>% 
	mutate(.fitted_prob = logit_to_prob(.fitted)) %>% 
	ggplot() +
	geom_hline(yintercept = 0.5, size = 1, colour = "grey") +
	stat_summary(aes(x = ot1, y = .fitted_prob, colour = trial_type, fill = trial_type),
				 fun.data = mean_se, geom = "ribbon", alpha = 0.5, colour = NA) +
	stat_summary(aes(x = ot1, y = .fitted_prob, colour = trial_type, fill = trial_type),
				 fun = mean, geom = "line", size = 1) +
	# stat_summary(fun.data = mean_se, geom = "pointrange", size = 0.25) +
	geom_text(data = sample_size,
			  aes(x = -0.3, y = 0.95, label = paste0("N = ", n)),
			  show.legend = FALSE,
			  colour = "black", fill = "black") +
	labs(x = "Time bin (100 ms)", y = "Pr(Target fixation)",
		 colour = "Trial type", fill = "Trial type") +
	scale_y_continuous(limits = c(0, 1), labels = percent) + 
	scale_x_continuous(breaks = unique(gaze$ot1), labels = unique(gaze$time_bin)) +
	theme(
		axis.title.y = element_blank(),
		axis.text = element_text(size = 7),
		legend.position = "left"
	) +
	
	augment(fit_21_mon) %>% 
	mutate(elog_prob = logit_to_prob(elog)) %>% 
	group_by(participant, trial_type) %>% 
	summarise(elog_prob = mean(elog_prob, na.rm = TRUE)) %>% 
	ggplot(aes(trial_type, elog_prob, fill = trial_type, colour = trial_type)) +
	geom_hline(yintercept = 0.5, size = 1, colour = "grey") +
	geom_violin(show.legend = FALSE) +
	geom_boxplot(width = 0.1, outlier.colour = NA, fill = "white", colour = "black") +
	labs(x = "Trial type", y = "Pr(Target fixation)",
		 colour = "Trial type", fill = "Trial type") +
	scale_y_continuous(limits = c(0, 1), labels = percent) + 
	theme(
		axis.title = element_blank(),
		axis.ticks = element_blank(),
		axis.text.x = element_blank(),
		axis.text.y = element_blank()
	) +
	plot_layout(ncol = 2, guides = "collect", widths = c(0.75, 0.25)) &
	plot_annotation(
		caption = "A: Marginal means of the multilevel model, plotted in separate panels for monolinguals and bilinguals, across age\ngroups. Sample sizes are indicated at the upper left corner in each panel. The first and last 300 ms in each trial\nwere trimmed before the analysis. B: mean observed probability of target looking, aggregated by participant.",
		tag_levels = "A") &
	theme_custom() &
	theme(
		legend.position = "right",
		plot.caption = element_text(size = 10, hjust = 0),
		plot.caption.position = "plot"
	)
```

### Location

```{r fixef_21_mon_location, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
main_effects <- confint.merMod(fit_21_mon_location, method = "Wald") %>% 
	as.data.frame() %>% 
	clean_names() %>% 
	drop_na(x2_5_percent) %>%
	rownames_to_column("term") %>% 
	right_join(clean_names(tidy(fit_21_mon_location, effects = "fixed"))) %>% 
	select(term, estimate, std_error, conf_lower = x2_5_percent, conf_upper = x97_5_percent,
		   statistic, df, p_value) %>% 
	gt() %>% 
	fmt_number(2:7) %>% 
	fmt_number(8, decimals = 3) %>% 
	cols_merge(starts_with("conf_"), pattern = "[{1}, {2}]") %>% 
	cols_label(
		term = md("**Predictor**"),
		estimate = md("**Estimate**"),
		std_error = md("**SE**"),
		conf_lower = md("**CI<sub>95%</sub>**"),
		statistic = md("***t***"),
		df = md("**df**"),
		p_value = md("***p***")
	) %>% 
	tab_style(
		style = list(
			cell_fill(color = "#ffc7a1")
		),
		locations = cells_body(
			columns = everything(),
			rows = p_value < 0.05
		)
	)

main_effects

```

```{r gaze_time_21_mon_location, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
sample_size <- participants %>% 
	filter(valid_participant, age_group=="21 months", lp=="Monolingual") %>% 
	count(age_group, location)

augment(fit_21_mon_location) %>% 
	mutate(.fitted_prob = logit_to_prob(.fitted)) %>% 
	ggplot() +
	facet_wrap(~location, ncol = 1) +
	geom_hline(yintercept = 0.5, size = 1, colour = "grey") +
	stat_summary(
		aes(x = ot1, y = .fitted_prob, colour = trial_type, fill = trial_type),
		fun.data = mean_se, geom = "ribbon", alpha = 0.5, colour = NA) +
	stat_summary(aes(x = ot1, y = .fitted_prob, colour = trial_type, fill = trial_type), fun = mean, geom = "line", size = 1) +
	# stat_summary(fun.data = mean_se, geom = "pointrange", size = 0.25) +
	geom_text(data = sample_size,
			  aes(x = -0.3, y = 0.95, label = paste0("n = ", n)),
			  colour = "black", fill = "black", show.legend = FALSE) +
	labs(x = "Time bin (100 ms)", y = "Pr(Target fixation)",
		 colour = "Trial type", fill = "Trial type") +
	scale_y_continuous(limits = c(0, 1), labels = percent) + 
	scale_x_continuous(breaks = unique(gaze$ot1), labels = unique(gaze$time_bin)) +
	theme(
		axis.title.y = element_blank(),
		axis.text = element_text(size = 7),
		legend.position = "left"
	) +
	
	augment(fit_21_mon_location) %>% 
	mutate(elog_prob = logit_to_prob(elog)) %>% 
	group_by(participant, location, trial_type) %>% 
	summarise(elog_prob = mean(elog_prob, na.rm = TRUE)) %>% 
	ggplot(aes(trial_type, elog_prob, fill = trial_type, colour = trial_type)) +
	facet_wrap(~location, ncol = 1) +
	geom_hline(yintercept = 0.5, size = 1, colour = "grey") +
	geom_violin(show.legend = FALSE) +
	geom_boxplot(width = 0.1, outlier.colour = NA, fill = "white", colour = "black") +
	labs(x = "Trial type", y = "Pr(Target fixation)",
		 colour = "Trial type", fill = "Trial type") +
	scale_y_continuous(limits = c(0, 1), labels = percent) + 
	theme(
		axis.title = element_blank(),
		axis.ticks = element_blank(),
		axis.text.x = element_blank(),
		axis.text.y = element_blank()
	) +
	plot_layout(ncol = 2, guides = "collect", widths = c(0.5, 0.5)) &
	theme_custom() &
	theme(
		legend.position = "right",
		plot.caption = element_text(size = 10, hjust = 0),
		plot.caption.position = "plot"
	)
```

### Vocabulary (median split)

```{r fixef_21_mon_vocab, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
main_effects <- confint.merMod(fit_21_mon_vocab, method = "Wald") %>% 
	as.data.frame() %>% 
	clean_names() %>% 
	drop_na(x2_5_percent) %>%
	rownames_to_column("term") %>% 
	right_join(clean_names(tidy(fit_21_mon_vocab, effects = "fixed"))) %>% 
	select(term, estimate, std_error, conf_lower = x2_5_percent, conf_upper = x97_5_percent,
		   statistic, df, p_value) %>% 
	gt() %>% 
	fmt_number(2:7) %>% 
	fmt_number(8, decimals = 3) %>% 
	cols_merge(starts_with("conf_"), pattern = "[{1}, {2}]") %>% 
	cols_label(
		term = md("**Predictor**"),
		estimate = md("**Estimate**"),
		std_error = md("**SE**"),
		conf_lower = md("**CI<sub>95%</sub>**"),
		statistic = md("***t***"),
		df = md("**df**"),
		p_value = md("***p***")
	) %>% 
	tab_style(
		style = list(
			cell_fill(color = "#ffc7a1")
		),
		locations = cells_body(
			columns = everything(),
			rows = p_value < 0.05
		)
	)
main_effects

```

```{r gaze_time_21_mon_vocab, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

sample_size <- participants %>% 
	drop_na(vocab_size_l1_center) %>% 
	filter(valid_participant, age_group=="21 months", lp=="Monolingual") %>% 
	mutate(vocab_cat = ifelse(vocab_size_l1_center > median(participants$vocab_size_l1_center, na.rm = TRUE), "Above median", "Below median")) %>% 
	count(age_group, vocab_cat, lp)

augment(fit_21_mon_vocab) %>% 
	mutate(.fitted_prob = logit_to_prob(.fitted)) %>% 
	ggplot() +
	facet_wrap(~vocab_cat, ncol = 1) +
	geom_hline(yintercept = 0.5, size = 1, colour = "grey") +
	stat_summary(aes(x = ot1, y = .fitted_prob, colour = trial_type, fill = trial_type),
				 fun.data = mean_se, geom = "ribbon", alpha = 0.5, colour = NA) +
	stat_summary(aes(x = ot1, y = .fitted_prob, colour = trial_type, fill = trial_type),
				 fun = mean, geom = "line", size = 1) +
	# stat_summary(fun.data = mean_se, geom = "pointrange", size = 0.25) +
	geom_text(data = sample_size,
			  aes(x = -0.3, y = 0.95, label = paste0("N = ", n)),
			  show.legend = FALSE,
			  colour = "black", fill = "black") +
	labs(x = "Time bin (100 ms)", y = "Pr(Target fixation)",
		 colour = "Trial type", fill = "Trial type") +
	scale_y_continuous(limits = c(0, 1), labels = percent) + 
	scale_x_continuous(breaks = unique(gaze$ot1), labels = unique(gaze$time_bin)) +
	theme(
		axis.title.y = element_blank(),
		axis.text = element_text(size = 7),
		legend.position = "left"
	) +
	
	augment(fit_21_mon_vocab) %>% 
	mutate(elog_prob = logit_to_prob(elog)) %>% 
	group_by(participant, vocab_cat, trial_type) %>% 
	summarise(elog_prob = mean(elog_prob, na.rm = TRUE)) %>% 
	ggplot(aes(trial_type, elog_prob)) +
	facet_wrap(~vocab_cat, ncol = 1) +
	geom_hline(yintercept = 0.5, size = 1, colour = "grey") +
	geom_violin(aes( fill = trial_type, colour = trial_type), show.legend = FALSE) +
	geom_boxplot(width = 0.1, outlier.colour = NA, fill = "white", colour = "black") +
	# stat_summary(fun.data = mean_se, geom = "pointrange", size = 0.25) +
	labs(x = "Trial type", y = "Pr(Target fixation)",
		 colour = "Trial type", fill = "Trial type") +
	scale_y_continuous(limits = c(0, 1), labels = percent) + 
	theme(
		axis.title = element_blank(),
		axis.ticks = element_blank(),
		axis.text.x = element_blank(),
		axis.text.y = element_blank()
	) +
	plot_layout(ncol = 2, guides = "collect", widths = c(0.5, 0.5)) &
	theme_custom() &
	theme(
		legend.position = "right",
		plot.caption = element_text(size = 10, hjust = 0),
		plot.caption.position = "plot"
	)
```

### Vocabulary (balanced)

```{r fixef_21_mon_vocab_pct, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

main_effects <- confint.merMod(fit_21_mon_vocab_pct, method = "Wald") %>% 
	as.data.frame() %>% 
	clean_names() %>% 
	drop_na(x2_5_percent) %>%
	rownames_to_column("term") %>% 
	right_join(clean_names(tidy(fit_21_mon_vocab_pct, effects = "fixed"))) %>% 
	select(term, estimate, std_error, conf_lower = x2_5_percent, conf_upper = x97_5_percent,
		   statistic, df, p_value) %>% 
	gt() %>% 
	fmt_number(2:7) %>% 
	fmt_number(8, decimals = 3) %>% 
	cols_merge(starts_with("conf_"), pattern = "[{1}, {2}]") %>% 
	cols_label(
		term = md("**Predictor**"),
		estimate = md("**Estimate**"),
		std_error = md("**SE**"),
		conf_lower = md("**CI<sub>95%</sub>**"),
		statistic = md("***t***"),
		df = md("**df**"),
		p_value = md("***p***")
	) %>% 
	tab_style(
		style = list(
			cell_fill(color = "#ffc7a1")
		),
		locations = cells_body(
			columns = everything(),
			rows = p_value < 0.05
		)
	)
main_effects

```

```{r gaze_time_21_mon_vocab_pct, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
# by vocab (balanced)
sample_size <- participants %>%
	drop_na(vocab_size_l1_center) %>% 
	filter(age_group=="21 months", lp=="Monolingual") %>% 
	arrange(location, desc(vocab_size_l1_center)) %>% 
	group_by(location) %>% 
	mutate(vocab_index = row_number()) %>% 
	ungroup() %>% 
	filter(
		((location=="Barcelona") & (vocab_index %in% 1:15)) |
			((location=="Oxford")) & (vocab_index %in% seq(
				max(vocab_index[location=="Oxford"])-15,
				max(vocab_index[location=="Oxford"])))
	) %>% 
	nrow() %>% 
	data.frame(n = .)

augment(fit_21_mon_vocab_pct) %>% 
	mutate(.fitted_prob = logit_to_prob(.fitted)) %>% 
	ggplot() +
	geom_hline(yintercept = 0.5, size = 1, colour = "grey") +
	stat_summary(
		aes(x = ot1, y = .fitted_prob, colour = trial_type, fill = trial_type),
		fun.data = mean_se, geom = "ribbon", alpha = 0.5, colour = NA) +
	stat_summary(aes(x = ot1, y = .fitted_prob, colour = trial_type, fill = trial_type), fun = mean, geom = "line", size = 1) +
	# stat_summary(fun.data = mean_se, geom = "pointrange", size = 0.25) +
	geom_text(data = sample_size,
			  aes(x = -0.3, y = 0.95, label = paste0("n = ", n)),
			  colour = "black", fill = "black", show.legend = FALSE) +
	labs(x = "Time bin (100 ms)", y = "Pr(Target fixation)",
		 colour = "Trial type", fill = "Trial type") +
	scale_y_continuous(limits = c(0, 1), labels = percent) + 
	scale_x_continuous(breaks = unique(gaze$ot1), labels = unique(gaze$time_bin)) +
	theme(
		axis.title.y = element_blank(),
		axis.text = element_text(size = 7),
		legend.position = "left"
	) +
	
	augment(fit_21_mon_vocab_pct) %>% 
	mutate(elog_prob = logit_to_prob(elog)) %>% 
	group_by(participant, trial_type) %>% 
	summarise(elog_prob = mean(elog_prob, na.rm = TRUE)) %>% 
	ggplot(aes(trial_type, elog_prob)) +
	geom_hline(yintercept = 0.5, size = 1, colour = "grey") +
	geom_violin(aes(fill = trial_type, colour = trial_type), show.legend = FALSE) +
	geom_boxplot(width = 0.1, outlier.colour = NA) +
	labs(x = "Trial type", y = "Pr(Target fixation)",
		 colour = "Trial type", fill = "Trial type") +
	scale_y_continuous(limits = c(0, 1), labels = percent) + 
	theme(
		axis.title = element_blank(),
		axis.ticks = element_blank(),
		axis.text.x = element_blank(),
		axis.text.y = element_blank()
	) +
	plot_layout(ncol = 2, guides = "collect", widths = c(0.75, 0.25)) &
	theme_custom() &
	theme(
		legend.position = "right",
		plot.caption = element_text(size = 10, hjust = 0),
		plot.caption.position = "plot"
	)
```


### {-}


## Vocabulary {.tabset .tab-pills}


### L1 vocabulary

This figure represents the vocabulary size in the dominant language of participants in the Y-axis and their linguistic profile in the X-axis. Results are presented separately for each age group. The shape of the violins, represents the distribution of the vocabulary sizes. The box-plot inside each violin represents the median, 25th and 75th percentiles, and the vertical lines represent the minimum and maximum values. vocabulary sizes in the dominant language were calculated as the proportion of items each participant was reported to *understand* or *understand and say* in the language of most exposure. for example, for a participant exposed mostly to Catalan, their vocabulary size in the dominant language was calculated as the proportion of words they were reported to understand and/or say in Catalan, from a total of ~200 words.

```{r vocabulary_l1, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4}
sample_size <- participants %>% 
	filter(valid_participant, !is.na(vocab_size_l1)) %>% 
	count(age_group, location)

# vocabulary
participants %>% 
	left_join(distinct(attrition, participant, age_group, valid_participant)) %>% 
	drop_na(lp) %>%
	filter(valid_participant) %>% 
	ggplot() +
	facet_grid(location~age_group) +
	# geom_violin(
	# 	position = position_dodge(width = 0.75),
	# 	aes(lp, vocab_size_l1, colour = lp, fill = lp)
	# ) + 
	geom_hline(yintercept = 0.5, colour = "grey") +
	geom_point(
		aes(lp, vocab_size_l1),
		shape = 1, colour = "black", alpha = 0.5, size = 1, stroke = 1,
		position = position_jitter(width = 0.1, seed = 888)
	) +
	geom_boxplot(
		aes(lp, vocab_size_l1, colour = lp, fill = lp),
		width = 0.25, colour = "black", outlier.colour = NA,
		position = position_dodge(width = 0.75)
	) +
	geom_text(
		data = sample_size,
		aes(x = 1.5, y = 0.95, label = paste0("n = ", n)),
		colour = "black", fill = "black", show.legend = FALSE
	) +
	labs(y = "Receptive vocabulary (L1)", colour = "Group", fill = "Group") +
	scale_y_continuous(limits = c(0, 1), labels = percent) +
	theme(
		legend.title = element_blank(),
		legend.position = "none",
		axis.title.x = element_blank(),
		axis.text = element_text(size = 9),
		panel.grid.major.y = element_line(colour = "grey", linetype = "dotted")
	)

```


### Total vocabulary

```{r vocabulary_total, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4}
sample_size <- participants %>% 
	filter(valid_participant, !is.na(vocab_size_l1)) %>% 
	count(age_group, location)

# vocabulary
participants %>% 
	left_join(distinct(attrition, participant, age_group, valid_participant)) %>% 
	drop_na(lp) %>%
	filter(valid_participant) %>% 
	ggplot() +
	facet_grid(location~age_group) +
	# geom_violin(
	# 	position = position_dodge(width = 0.75),
	# 	aes(lp, vocab_size_l1, colour = lp, fill = lp)
	# ) + 
	geom_hline(yintercept = 0.5, colour = "grey") +
	geom_point(
		aes(lp, vocab_size_total),
		shape = 1, colour = "black", alpha = 0.5, size = 1, stroke = 1,
		position = position_jitter(width = 0.1, seed = 888)
	) +
	geom_boxplot(
		aes(lp, vocab_size_total, colour = lp, fill = lp),
		width = 0.25, colour = "black", outlier.colour = NA,
		position = position_dodge(width = 0.75)
	) +
	geom_text(
		data = sample_size,
		aes(x = 1.5, y = 0.95, label = paste0("n = ", n)),
		colour = "black", fill = "black", show.legend = FALSE
	) +
	labs(y = "Receptive vocabulary (L1+L2)", colour = "Group", fill = "Group") +
	scale_y_continuous(limits = c(0, 1), labels = percent) +
	theme(
		legend.title = element_blank(),
		legend.position = "none",
		axis.title.x = element_blank(),
		axis.text = element_text(size = 9),
		panel.grid.major.y = element_line(colour = "grey", linetype = "dotted")
	)

```


### Conceptual vocabulary


```{r vocabulary_conceptual, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4}
sample_size <- participants %>% 
	filter(valid_participant, !is.na(vocab_size_l1)) %>% 
	count(age_group, location)

# vocabulary
participants %>% 
	left_join(distinct(attrition, participant, age_group, valid_participant)) %>% 
	drop_na(lp) %>%
	filter(valid_participant) %>% 
	ggplot() +
	facet_grid(location~age_group) +
	# geom_violin(
	# 	position = position_dodge(width = 0.75),
	# 	aes(lp, vocab_size_l1, colour = lp, fill = lp)
	# ) + 
	geom_hline(yintercept = 0.5, colour = "grey") +
	geom_point(
		aes(lp, vocab_size_conceptual),
		shape = 1, colour = "black", alpha = 0.5, size = 1, stroke = 1,
		position = position_jitter(width = 0.1, seed = 888)
	) +
	geom_boxplot(
		aes(lp, vocab_size_conceptual, colour = lp, fill = lp),
		width = 0.25, colour = "black", outlier.colour = NA,
		position = position_dodge(width = 0.75)
	) +
	geom_text(
		data = sample_size,
		aes(x = 1.5, y = 0.95, label = paste0("n = ", n)),
		colour = "black", fill = "black", show.legend = FALSE
	) +
	labs(y = "Receptive vocabulary (coneptual)", colour = "Group", fill = "Group") +
	scale_y_continuous(limits = c(0, 1), labels = percent) +
	theme(
		legend.title = element_blank(),
		legend.position = "none",
		axis.title.x = element_blank(),
		axis.text = element_text(size = 9),
		panel.grid.major.y = element_line(colour = "grey", linetype = "dotted")
	)

```


### {-}


## {-}


# {-}


# Appendix


# References
