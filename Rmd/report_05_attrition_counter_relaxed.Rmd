---
---


##### Summary

```{r participants_cdi_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
# plot participants
participants_relaxed_counter %>% 
	left_join(distinct(attrition_relaxed_counter, participant, valid_participant)) %>%
	left_join(vocabulary) %>% 
	drop_na(valid_participant) %>% 
	mutate(
		valid_status = case_when(
			valid_participant & !is.na(vocab_size_l1) ~ "Valid (+ CDI)",
			valid_participant & is.na(vocab_size_l1) ~ "Valid (no CDI)",
			!valid_participant ~ "Not valid"
		)
	) %>% 
	ggplot(aes(lp, fill = valid_status)) +
	facet_grid(location~age_group, scales = "free") +
	geom_bar(colour = NA) +
	geom_hline(yintercept = 24, linetype = "dashed") +
	scale_colour_brewer(palette = "Set1") +
	labs(x = "Group", y = "Sample size", fill = "Valid?") +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.title.x = element_blank(),
		axis.text = element_text(size = 10),
		axis.title.y = element_text(angle = 90)
	) 
```


##### By location

```{r trials_attrition_location_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=8, out.width="100%"}
# plot participants
attrition_location <- attrition_relaxed_counter %>% 
	left_join(select(participants_relaxed_counter, participant, location)) %>% 
	count(location, lp, age_group, trial_type, valid_status) %>% 
	drop_na(trial_type)

attrition_location %>% 
	filter(location=="Barcelona") %>% 
	ggplot(aes(trial_type, n, fill = valid_status, colour = valid_status)) +
	facet_grid(lp~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity", title = "Barcelona") +
	
	attrition_location %>% 
	filter(location=="Oxford") %>% 
	ggplot(aes(trial_type, n, fill = valid_status, colour = valid_status)) +
	facet_grid(lp~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity", title = "Oxford") +
	
	plot_layout(guides = "collect", ncol = 1) &
	scale_y_continuous(labels = percent) &
	coord_flip() &
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 10),
		axis.title = element_blank()
	)
```


##### By group

This table shows a summary of the total, total valid, and proportion of valid monolingual and bilingual participants tested in each lab (Barcelona and Oxford), in each age group (21, 25, and 30 months), and the mean of valid trials they contributed in each trial type (cognate, non-cognate, and unrelated). 


```{r attrition_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=12}

left_join(
	attrition_relaxed_counter,
	select(
		participants_relaxed_counter, age_group, location, lp, participant, date_test)
) %>% 
	group_by(participant, lp, location, trial_type, date_test, age_group, valid_participant) %>% 
	summarise(valid_trial_count = sum(valid_trial, na.rm = TRUE),
			  .groups = "drop") %>% 
	pivot_wider(
		names_from = trial_type,
		values_from = valid_trial_count
	) %>% 
	clean_names() %>% 
	group_by(lp, location, age_group) %>% 
	summarise(
		cognate = mean(cognate, na.rm = TRUE),
		non_cognate = mean(non_cognate, na.rm = TRUE),
		unrelated = mean(unrelated, na.rm = TRUE),
		sum_n = sum(valid_participant, na.rm = TRUE),
		prop_n = mean(valid_participant, na.rm = TRUE),
		n = n(),
		.groups = "drop"
	) %>% 
	arrange(age_group, lp, location) %>% 
	relocate(age_group, lp, location, cognate, non_cognate, unrelated, sum_n, n, prop_n) %>% 
	gt() %>% 
	tab_spanner(
		"Mean valid trials",
		c("cognate", "non_cognate", "unrelated")
	) %>% 
	tab_spanner(
		"N participants",
		c("sum_n", "n", "prop_n")
	) %>% 
	cols_label(
		age_group = "Age",
		lp = "Group",
		sum_n = "Valid",
		location = "Laboratory",
		n = "Tested",
		prop_n = "Valid (%)",
		cognate = "Cognate (8)",
		non_cognate = "Non-cognate (8)",
		unrelated = "Unrelated (16)"
	) %>% 
	fmt_number(c("cognate", "non_cognate", "unrelated")) %>%
	fmt_percent(c("prop_n")) %>% 
	fmt_number(c("n", "sum_n"), decimals = 0)

```


##### By participant


```{r participants_attrition_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
# plot participants
attrition_relaxed_counter %>% 
	left_join(select(participants_relaxed_counter, participant, location)) %>% 
	mutate(participant = str_remove(participant, "cognatepriming")) %>% 
	group_by(location, participant, lp, age_group, valid_participant) %>% 
	summarise(
		valid = mean(valid_trial),
		invalid_gaze = mean(!valid_gaze),
		invalid_vocab = mean(!valid_vocab),
		.groups = "drop"
	) %>% 
	relocate(participant) %>% 
	gt() %>% 
	tab_spanner(label = "Invalid trials", columns = starts_with("invalid_")) %>% 
	cols_label(
		participant = "Participant",
		location = "Location",
		lp = "Lang. Profile",
		age_group = "Age",
		valid_participant = "Valid participant",
		valid = "Valid trials (%)",
		invalid_gaze = "Gaze (%)",
		invalid_vocab = "Vocabulary (%)"
	) %>% 
	fmt_percent(c("valid", "invalid_gaze", "invalid_vocab")) %>% 
	div(style='height:600px; overflow-y: scroll', .)
```


##### By trial


```{r trials_attrition_table_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
# plot participants
attrition_relaxed_counter %>% 
	left_join(select(participants_relaxed_counter, participant, location)) %>% 
	drop_na(trial_type) %>% 
	group_by(location, lp, age_group, trial_type, valid_trial) %>% 
	count() %>% 
	ungroup() %>%
	mutate(valid_trial = ifelse(valid_trial, "Valid", "Not valid")) %>% 
	pivot_wider(names_from = c(age_group, valid_trial), values_from = n, values_fill = 0) %>% 
	clean_names() %>% 
	gt(groupname_col = c("location", "lp")) %>% 
	tab_spanner(label = "21 months", columns = contains("21_")) %>% 
	tab_spanner(label = "25 months", columns = contains("25_")) %>% 
	tab_spanner(label = "30 months", columns = contains("30_")) %>% 
	cols_label(
		location = "Location",
		lp = "Group",
		trial_type = "Trial type",
		x21_months_not_valid = "Not valid",
		x21_months_valid = "Valid",
		x25_months_not_valid = "Not valid",
		x25_months_valid = "Valid",
		x30_months_not_valid = "Not valid",
		x30_months_valid = "Valid"
	)


```


```{r trials_attrition_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
# plot participants
attrition_relaxed_counter %>% 
	left_join(select(participants_relaxed_counter, participant, location)) %>% 
	count(location, lp, age_group, trial_type, valid_status) %>% 
	drop_na(trial_type) %>% 
	ggplot(aes(trial_type, n, fill = valid_status, colour = valid_status)) +
	facet_grid(lp~age_group) +
	geom_col(position = position_fill()) +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	scale_y_continuous(labels = percent) +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(angle = 20, hjust = 1, vjust = 1, size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```


##### By lexical frequency {.tabset }

###### Prime frequency

```{r attrition_frequency_prime_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
sample_size <- attrition_relaxed_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, frequency_prime_childes)) %>% 
	mutate(valid_status = ifelse(valid_status!="Valid", "Invalid", valid_status)) %>% 
	drop_na(trial_type, frequency_prime_childes) %>% 
	count(trial_type, lp, age_group, valid_status)

attrition_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, frequency_prime_childes)) %>% 
	mutate(valid_status = ifelse(valid_status!="Valid", "Invalid", valid_status)) %>% 
	drop_na(trial_type, frequency_prime_childes) %>% 
	ggplot(aes(trial_type, frequency_prime_childes, fill = valid_status, colour = valid_status)) +
	facet_grid(lp~age_group) +
	geom_boxplot(fill = "white", width = 0.25,
				 position =  position_dodge(width = 0.5),
				 size = 1, outlier.colour = NA) +
	geom_label(data = sample_size, aes(y = 2, label = n), size = 3,
			   position = position_dodge(width = 0.7), colour = "white") +
	labs(x = "Trial type", y = "Frequency (CHILDES)", colour = "Validity", fill = "Validity") +
	scale_y_continuous(breaks = 0:7, limits = c(0, 7)) +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		panel.grid.major.y = element_line(colour = "grey", linetype = "dotted"),
		axis.text.x = element_text(angle = 20, hjust = 1, vjust = 1, size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```


```{r attrition_frequency_prime_causes_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
# plot participants
attrition_relaxed_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, frequency_prime_childes)) %>% 
	drop_na(trial_type, frequency_prime_childes) %>% 
	mutate(frequency_prime_childes = round(frequency_prime_childes)) %>% 
	count(trial_type, age_group, valid_status, trial_type, frequency_prime_childes) %>% 
	ggplot(aes(as.factor(frequency_prime_childes), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```


###### Target frequency

```{r attrition_frequency_target_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
sample_size <- attrition_relaxed_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, frequency_target_childes)) %>% 
	mutate(valid_status = ifelse(valid_status!="Valid", "Invalid", valid_status)) %>% 
	drop_na(trial_type, frequency_target_childes) %>% 
	count(trial_type, lp, age_group, valid_status)

attrition_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, frequency_target_childes)) %>% 
	mutate(valid_status = ifelse(valid_status!="Valid", "Invalid", valid_status)) %>% 
	drop_na(trial_type, frequency_target_childes) %>% 
	ggplot(aes(trial_type, frequency_target_childes, fill = valid_status, colour = valid_status)) +
	facet_grid(lp~age_group) +
	geom_boxplot(fill = "white", width = 0.25,
				 position =  position_dodge(width = 0.5),
				 size = 1, outlier.colour = NA) +
	geom_label(data = sample_size, aes(y = 2, label = n), size = 3,
			   position = position_dodge(width = 0.7), colour = "white") +
	labs(x = "Trial type", y = "Frequency (CHILDES)", colour = "Validity", fill = "Validity") +
	scale_y_continuous(breaks = 0:7, limits = c(0, 7)) +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		panel.grid.major.y = element_line(colour = "grey", linetype = "dotted"),
		axis.text.x = element_text(angle = 20, hjust = 1, vjust = 1, size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```


```{r attrition_frequency_target_causes_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
attrition_relaxed_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, frequency_target_childes)) %>% 
	drop_na(trial_type, frequency_target_childes) %>% 
	mutate(frequency_target_childes = round(frequency_target_childes)) %>% 
	count(trial_type, age_group, valid_status, trial_type, frequency_target_childes) %>% 
	ggplot(aes(as.factor(frequency_target_childes), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```


###### {-}


##### By familiarity {.tabset}


###### Prime familiarity

```{r attrition_familiarity_prime_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
sample_size <- attrition_relaxed_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, familiarity_prime)) %>% 
	mutate(valid_status = ifelse(valid_status!="Valid", "Invalid", valid_status)) %>% 
	drop_na(trial_type, familiarity_prime) %>% 
	count(trial_type, lp, age_group, valid_status)

attrition_relaxed_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, familiarity_prime)) %>% 
	mutate(valid_status = ifelse(valid_status!="Valid", "Invalid", valid_status)) %>% 
	drop_na(trial_type, familiarity_prime) %>% 
	ggplot(aes(trial_type, familiarity_prime, fill = valid_status, colour = valid_status)) +
	facet_grid(lp~age_group) +
	geom_boxplot(fill = "white", width = 0.25,
				 position =  position_dodge(width = 0.5),
				 size = 1, outlier.colour = NA) +
	geom_label(data = sample_size, aes(y = 0.1, label = n), size = 3,
			   position = position_dodge(width = 0.7), colour = "white") +
	labs(x = "Trial type", y = "Familiarity", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_y_continuous(labels = percent, limits = c(0, 1)) +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		panel.grid.major.y = element_line(colour = "grey", linetype = "dotted"),
		axis.text.x = element_text(angle = 20, hjust = 1, vjust = 1, size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```



```{r attrition_familiarity_prime_causes_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
# plot participants
attrition_relaxed_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, familiarity_prime)) %>% 
	drop_na(trial_type, familiarity_prime) %>% 
	mutate(familiarity_prime = round(familiarity_prime, digits = 1)) %>% 
	count(trial_type, age_group, valid_status, trial_type, familiarity_prime) %>% 
	ggplot(aes(as.factor(familiarity_prime), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_x_discrete(labels = function(x) paste0(as.numeric(x)*100, "%")) +
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```


###### Target familiarity

```{r attrition_familiarity_target_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
sample_size <- attrition_relaxed_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, familiarity_target)) %>% 
	mutate(valid_status = ifelse(valid_status!="Valid", "Invalid", valid_status)) %>% 
	drop_na(trial_type, familiarity_target) %>% 
	count(trial_type, lp, age_group, valid_status)

attrition_relaxed_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, familiarity_target)) %>% 
	mutate(valid_status = ifelse(valid_status!="Valid", "Invalid", valid_status)) %>% 
	drop_na(trial_type, familiarity_target) %>% 
	ggplot(aes(trial_type, familiarity_target, fill = valid_status, colour = valid_status)) +
	facet_grid(lp~age_group) +
	geom_boxplot(fill = "white", width = 0.25,
				 position =  position_dodge(width = 0.5),
				 size = 1, outlier.colour = NA) +
	geom_label(data = sample_size, aes(y = 0.1, label = n), size = 3,
			   position = position_dodge(width = 0.7), colour = "white") +
	labs(x = "Trial type", y = "Familiarity", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_y_continuous(labels = percent, limits = c(0, 1)) +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		panel.grid.major.y = element_line(colour = "grey", linetype = "dotted"),
		axis.text.x = element_text(angle = 20, hjust = 1, vjust = 1, size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```


```{r attrition_familiarity_target_causes_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.height=4, out.width="100%"}
# plot participants
attrition_relaxed_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, familiarity_target)) %>% 
	drop_na(trial_type, familiarity_target) %>% 
	mutate(familiarity_target = round(familiarity_target, digits = 1)) %>% 
	count(trial_type, age_group, valid_status, trial_type, familiarity_target) %>% 
	ggplot(aes(as.factor(familiarity_target), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_x_discrete(labels = function(x) paste0(as.numeric(x)*100, "%")) +
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```


###### {-}


##### By animacy {.tabset }



###### Prime


```{r attrition_animacy_prime_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
attrition_relaxed_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, is_animate_prime)) %>%
	mutate(is_animate_prime = ifelse(is_animate_prime, "Animate", "Inanimate")) %>% 
	drop_na(trial_type, is_animate_prime) %>% 
	count(trial_type, location, age_group, valid_status, trial_type, is_animate_prime) %>% 
	ggplot(aes(as.factor(is_animate_prime), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)

```


###### Target


```{r attrition_animacy_target_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
attrition_relaxed_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, is_animate_target)) %>%
	mutate(is_animate_target = ifelse(is_animate_target, "Animate", "Inanimate")) %>% 
	drop_na(trial_type, is_animate_target) %>% 
	count(trial_type, age_group, valid_status, trial_type, is_animate_target) %>% 
	ggplot(aes(as.factor(is_animate_target), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)

```


###### {-}


##### By category {.tabset}


###### Prime


```{r attrition_category_prime_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
attrition_relaxed_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, category_prime)) %>%
	drop_na(trial_type, category_prime) %>% 
	count(trial_type, age_group, valid_status, trial_type, category_prime) %>% 
	ggplot(aes(fct_rev(category_prime), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```


###### Target

```{r attrition_category_target_relaxed_counter, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
attrition_relaxed_counter %>% 
	left_join(distinct(stimuli, test_language, location, list, trial, trial_type, category_target)) %>%
	drop_na(trial_type, category_target) %>% 
	count(trial_type, age_group, valid_status, trial_type, category_target) %>% 
	ggplot(aes(fct_rev(category_target), n, fill = valid_status, colour = valid_status)) +
	facet_grid(trial_type~age_group) +
	geom_col(position = position_fill(), colour = "white") +
	labs(x = "Trial type", y = "Trials", colour = "Validity", fill = "Validity") +
	guides(fill = guide_legend(ncol = 2), colour = guide_legend(ncol = 2))	+
	scale_y_continuous(labels = percent) +
	coord_flip() +
	theme(
		legend.position = "top",
		legend.title = element_blank(),
		axis.text.x = element_text(size = 10),
		axis.text.y = element_text(size = 8),
		axis.title = element_blank()
	)
```

###### {-}

